# Random Variables and Distributions

So far in this section, we've talked about probabilities, different ways of thinking about probabilities, and a bit about how to work with probabilities. In this section we will introduce a more formal framework for how to think about and handle uncertain events. By making a few assumptions about how things behave, we can calculate probabilities of events without observing them.

## Random Variables

A *random variable* is a variable where the value is not guarenteed in advance, but can take different values. 

### Examples: random variables {-}

Define a variable $X$ to be the outcome of a coin flip. Now, before we flip the coin, we do not know what value $X$ will take on -- it could be "heads" or it could be "tails". Once we flip the coin and observe the outcome, we say that we have a *realization* of the random variable $X$. 

Another example would be if we let $Y$ be the height of a randomly chosen US adult. We don't know exactly what value it is, but we do know a few things about it. For example, it is much more likely to be around 5.5ft than it is to be around 7ft or below 4ft. When we do finally randomly select a US adult, and measure their height, we get a realization of this random variable. 

A third example is if we let $Z$ denote the diabetes status of a randomly chosen US adult. This could take the values healthy, type I, or type II, and each will happen with some probability. 

--- 

As the example above was meant to illustrate, a random variable can really be anything you'd like. And whenever we talk about a random variable, we also talk about the probability of certain outcomes. If we can define a way to calculate probabilities of different outcomes of the random variable, we call this the *distribution* of the random variable. 

Recall previously we talked about two kinds of variables: discrete and continuous variables. Likewise, we can consider both discrete and continuous *random* variables. Depending on the kind of random variable we're discussing, defining it's distribution is handled slightly differently. When we consider discrete random variables, its distribution is defined by specifying the probability of every single possible outcome. There are two things that are important to remember:

1. all probabilities must be between $0$ and $1$,
2. the sum of all probabilities must add up to $1$. 

The second point above is important, and is sometimes super handy when trying to calculate probabilities of certain complicated events. The intuition behind it is pretty simple: something must happen. So the probability that something happens is $1$. 

### Examples: discrete distributions {-}

Consider $X$ the outcome of a coin flip. The outcome of this can be one of two things: heads or tails. Now, let us pretend that this particular coin is NOT fair, i.e. it is not 50/50. Maybe the probability of getting tails is 0.4. Maybe the probability of getting heads is 0.1. For now, let the probability of getting heads be $p$, some number between 0 and 1. Then the probability of $X$ coming up as heads is $p$, and the probability it comes up as tails is $1-p$, since the sum of all probabilities has to be $1$. We write $P(X = \text{heads}) = p$ and $P(X = \text{tails}) = 1-p$. This is the distribution of $X$. In this case, all we need is the probability of the two outcomes. 

Another example: let $X$ be the marital status of a randomly chosen participant from the SHOW data. 

---

The examples above all consider discrete random variables. As already mentioned, the approach for continuous random variables is a bit different. For the distribution of a continuous random variable, we need to specify a curve for which the area under the curve is $1$. When we talk about probabilities of events that relate to the correpsonding random variable, we talk about areas under the curve.

### Examples: continuous distributions {-}

```{r}
full_SHOW <- read_csv("../data/SHOW.csv") %>% 
  rename(marital = "DMQ040")

ggplot(full_SHOW, 
       aes(x = ANT_MEAS_HEIGHT_CM)) + 
  geom_histogram(aes(y = ..density..),
                 bins = 35) + 
  stat_function(fun = dnorm, 
                args = list(mean = mean(full_SHOW$ANT_MEAS_HEIGHT_CM, na.rm = T),
                            sd = sd(full_SHOW$ANT_MEAS_HEIGHT_CM, na.rm = T)))
```

## Properties of Random Variables

When we talk about random variables, there is a great deal of uncertainty involved, since (by design) we do not know exactly what values the random variables will take after a conducted experiment. Similarly, we cannot be sure that repeating an experiment results in the same outcomes of the random variables simply since they are, as the name strongly implies, random. However, if we have some information about the random variable we're interested in, we can talk about some very important features of the random variable. The two we will talk about here are the *expected value* and *variance/standard deviation* of random variables. 

These two concepts can be a bit hard to wrap ones head around at first, but as we talk about them over and over agian, hopefully you will realize that they are not as abstract as they might first seem.

### Expected Value of Random Variables {-}

The expected value of a random variable is, intuitively, the long run average. I.e. if we repeat an experiment **an infinite number of times**, we can determine the expected value of a random variable as the average of all the realizations of said random variable. As an example, if we consider the random variable $X$ that is $0$ if a coin flip comes up heads, and $1$ if it comes up tails, we can imagine flipping a coin an infinite number of times, and calculating the average. The result would be that the expected value of $X$ is $0.5$. We write $E(X) = 0.5$. 

Since the expected value can be thought of as the long run average, it is in some sense the value that the outcomes of the random variable are going to be centered around. 

Note: the expected value is also often referred to as the *mean* value. 

For any discrete random variable where we know the distribution, we can find the expected value in the following way: $E(X) = x_1 \cdot P(X = x_1) + ... + x_n P(X = x_n) = \sum_{i=1}^n x_i P(X = x_i)$.^[**Note**: the symbol $\sum$ simply means "sum". So, when we write $\sum_{i=1}^n ...$ it simply means "take the expression ..., plug in the value when $i=1,2,3,...,n$, and then add them up". Example: $\sum_{i=1}^5 i = 1 + 2 + 3 + 4 + 5 = 15$. Example 2: if $x_1 = 1, x_2 = 6, x_3 = -2.9$, then $\sum_{i = 1}^3 x_i = 1 + 6 - 2.9 = 4.1$.]


#### Example: expected value of discrete random variable {-}

Let $X$ be a discrete random variable the can take the values $1,2,6$, and $12$. Let the probabilities of each outcome be as follows:

```{r}
mean_discrete_example <- tibble(x = c(1,2,6,12), `P(X = x)` = c(0.2, 0.1, 0.6, 0.1))
pander::pander(mean_discrete_example)
```

Then we can calculate the expected value of $X$: 

$$
\begin{align}
  E(X) &= \sum_{i = 1}^4 x_i P(X = x_i) \\
       &= 1 \cdot P(X = 1) + 2 \cdot P(X = 2) + 6 \cdot P(X = 6) + 12 \cdot P(X = 12) \\
       &= 1\cdot 0.2 + 2\cdot 0.1 + 6 \cdot 0.6 + 12 \cdot 0.1 \\
       &= 5.2.
\end{align}
$$

So what does this mean? It means that if we perform an experiment that results in a realization of the random variable $X$ many, many, many times, the average of all outcomes is going to be close to $5.2$.  

---

#### Example: expected value of a continuous random variable {-}

In the continuous case, actually calculating the expected value isn't as easy as in the discrete case. Remember, when we specify a discrete distribution, we specify the probability of each possible outcome. When we specify a continuous distribution, we specify a curve over all the possible outcomes, and probabilities of specific events correspond to areas under the curve. This also means that it is impossible to use a formula like the one introduced for the discrete case above. Fortunately, the intuition is the same. The expected it the long run average. 


---

#### Rules for working with expected values {-}

Sometimes, it is very beneficial to be able to transform a random variable, or combine several random variables, into a new one, and work with that new random variable. Fortunately, dealing with the expected value of a large number of such transformations is pretty simple. 

First, let's imagine we have a random variable $X$ with mean $E(X)$, and another random variable $Y$ with mean $E(Y)$. Perhaps we are interested in the sum of the two, so we construct a new random variable $Z = X + Y$.^[Example: maybe we sent out a survey to a bunch of households asking for the income of each adult in the household ($X$ and $Y$), and now we want to combine the two into a single total household income ($Z = X + Y$).] Finding the expected value of $Z$ is really simple: $E(Z) = E(X + Y) = E(X) + E(Y)$. In words: the expected value of a sum of random variables is simply the sum of expected values. 

Another example: maybe we want to scale the outcome of the random variable $X$ by a constant $a$, and then consider the new random variable $Y = a\cdot X$.^[Example: maybe $X$ is the total household income found from a survey in Europe where the currency is Euro. We want to compare this to our study of household incomes in the U.S., but to do so we have to convert from Euro to US Dollars. Here, $X$ is the household income in Euro, $a$ the exchange rate from Euro to US Dollars, and $Y$ the household income in US Dollars.] Again, finding the expected value of the new random variable $Y$ is really simple: $E(Y) = E(aX) = a\cdot E(X)$. 

One final thing I want to mention here: the expected value of a constant will always be the constant itself. Hopefully, this doesn't come as too much of a shock. The expected value is what we would *expect* from a random variable. If something is constant, it means it never changes, so we *expect* it to stay the same. So, if $a$ is a constant, $E(a) = a$. This can be combined with the first rule we talked about to give us that $E(X + a) = E(X) + E(a) = E(X) + a$. 


### Variance/Standard Deviation of Random Variables {-}

Where the expected value of a random variable tells us something about where the outcomes of the random variable tend to be located, the next measures we'll be looking at tell us something about how spread out the outcomes will be around the expected value.

**Note**: most textbooks handle the variance and standard deviations as two distinct things. I don't like that. They are virtually two sides of the same coin, and I will deliberately handle the two at the same time. My reasoning for this is that, at least in my head, these two measures try to convey the same message, but to two different audiences. I will elaborate on this later, but try to keep in mind that these two measures are almost the same. 

The *variance* of a random variable is a measure that tells us how much we expect the outcome of said random variable to vary from the expected value. As with the expected value, it is relatively simple to calculate this when we are dealing with simple discrete random variables. Let's say that we observe $n$ outcomes of a random variable $X$, $x_1, x_2, ..., x_n$. Then the variance of this sample of outcomes is $\Var(X) = \frac{1}{n-1} \sum_{i=1}^n (x_i - \bar{x})^2$, where $\bar{x}$ is the average of the values. If we were to break down this equation to better understand what's going on, we might do that in the following way:

1. It almost has the form $\frac{1}{n}\sum_{i=1}^n ...$, which is the form of an average. So, intuitively, we can think of this as an average
2. The values we take the average of, $(x_i - \bar{x})^2$, are representative of the distance from each observation to the average of the observations...
3. ... except, we square the distances. We do this because we want this measure to be representative of the variation of the data, and so we cannot allow positive and negative differences to cancel. Example: if we didn't square the differences, the sample of observation $1,2,3$ would have variance $0$, but clearly there is some variation in the sample -- not all observations are the same. 

So, loosely speaking, the variance is "a measure of averaged distances from observations to the sample average". 

#### Rules for working with variance {-}

Working with the variance of random variables is not quite as simple as working with the expected value. This is due to the fact that the expected value is a simple average, whereas the variance is an average of squared differences. The result is the following set of rules: if $X$ and $Y$ are random variables, and $a$ is some fixed constant, then 

1. $\Var(a\cdot X) = a^2 \Var(X)$,
2. $\Var(a) = 0$,
3. if (and ONLY if) $X$ and $Y$ are independent: $\Var(X+Y) = \Var(X) + \Var(Y)$.

Combining (1) and (2) above tells us that, if $X$ and $Y$ are independent, then $\Var(X - Y) = \Var(X + (-Y)) = \Var(X) + \Var(-Y) = \Var(X) + (-1)^2 \Var(Y) = \Var(X) + \Var(Y)$. Don't forget this!!

#### So what about that standard deviation? {-}

So far we've talked about the variance, a bit about how to interpret it, and how to work with it for multiple random variables. But what about that other thing mentioned above, the standard deviation? 

The standard deviation of a random variable is simply the square root of the variance: $\SD(X) = \sqrt{\Var(X)}$. The

### Things to remember when working with random variables {-}

When working with random variables, $X$ and $Y$, these are the important rules:

1. $E(X + Y) = E(X) + E(Y)$,
2. if $a$ is some fixed number, $E(a\cdot X) = a\cdot E(X)$,
3. if $a$ is some fixed number, $\Var(a \cdot X) = a^2 \Var(X)$,
4. **IF** $X$ and $Y$ are independent, $\Var(X + Y) = \Var(X) + \Var(Y)$,
5. **IF** $X$ and $Y$ are independent, $\Var(X - Y) = \Var(X) + \Var(Y)$. 

Things people often forget:

1. $E(X\cdot Y) \neq E(X)E(Y)$,
2. $E\left(\frac{X}{Y}\right) \neq \frac{E(X)}{E(Y)}$,
3. $\Var(X+Y) \neq \Var(X) + \Var(Y)$ if $X$ and $Y$ are not independent,
4. $\Var(X - Y) \neq \Var(X) - \Var(Y)$.

## A Few Important Distributions



### The Bernoulli Distribution {-}

In the first example above, we consider flipping a coin. Such an experiment, i.e. one with only two possible outcomes, is often referred to as a *Bernoulli experiment*, and the random variable $X$ is referred to as a *Bernoulli random variable*. The "probability of success" (you get to pick our favorite outcome as a success) is often denoted $p$. As a shorthand for such a random variable, we write $X \sim \text{Bernoulli}(p)$, which is read as "$X$ follows a Bernoulli distribution with probability parameter $p$" or "$X$ is Bernoulli distributed with parameter $p$". Phrases like these can sometimes sound scary and complex, but all it means is that the random variable $X$ can only take on two different outcomes, and the probability of $X$ being one of the two outcomes is $p$, the probability of it being the other is $1-p$. (Important note: remember that the sum of all probabilities has to be $1$, so if the probability of one outcome is $p$, and there are only two possible outcomes, then the probability of the other outcome must be $1-p$. This way of thinking is something we will use over and over again.)

### The Binomial Distribution {-}

Often times we are interested in things that can be viewed as a sum of Bernoulli random variables. Let's say we have $n$ independent (i.e. the outcome of one doesn't say anything about the rest) Bernoulli random variables ($X_1$, $X_2$, ..., $X_n$), all with probability of success $p$, and are interested in the sum of those $n$ variables $Y = X_1 + X_2 + ... + X_n$. For this to make sense, we let $X_i$ be $1$ if the corresponding "experiment" is a success, and $0$ if it is a failure. Now, we can think of the random variable $Y$ as either (1) the sum of independent Bernoulli random variables, or (2) the number of successes among $n$ independent trials with binary outcomes. It is this latter interpretation that makes the random variable $Y$ interesting. 

Let's think for a second about what possible values $Y$ can take. If all $n$ Bernoulli experiments happen to come out as failures, then all $X_i$'s are $0$'s, and so $Y$ will also be $0$. The other extreme is if all $n$ Bernoulli experiments are successes, then all $X_i$'s are $1$'s, and $Y$ will be the sum of $n$ $1$'s, so $Y$ will be $n$. These are simply the two extremes - any number of the $X_i$'s can be $1$'s, so $Y$ can end up being any integer between $0$ and $n$, both included. The most likely scenarios are the integers closest to the middle. 

Since $Y$ is simply a sum of very simple random variables, namely Bernoulli random variables, we can with very simple tools dive deeper, and try to explore what the distribution of a Binomial random variable looks like. There are two ways of doing this: (1) do the math, or (2) flip $n$ coins an infinite number of times and see how often the number of heads is each of the possible outcomes. Let's start with the latter. 

```{r binomial_example, cache = TRUE}
binom_n <- 100000
binom_n_print <- format(binom_n, scientific = F)

n <- 10

binom_outcomes <- tibble(i = 1:binom_n,
                         Numeric = map(i, function(...) as.numeric(rbernoulli(n))),
                         HTs = map_chr(Numeric, function(x) if_else(x == 1, "H", "T") %>% 
                                         paste(collapse = ",")),
                         Y = map_dbl(Numeric, sum)) %>% 
  select(i, HTs, Numeric, Y)
```

Since it's impossible to flip $n$ coins (for what is $n$?), we have to pick a real integer. Let's pick $`r n`$. Similarly, it's impossible to flip $`r n`$ coins an infinite number of times, so let's just do it a bunch of times (i.e. $`r `$). What we are about to do is repeat an experiment (flip $`r n`$ coins) many, many ($`r binom_n_print`$) times. The first time we perform this experiment, we see `r binom_outcomes$HTs[1]`. When we translate this to $0$ and $1$, it looks like `r paste(binom_outcomes$Numeric[[1]], collapse = ",")`. So, the value of the binomial variable $Y$ is `r binom_outcomes$Y[1]`. The results of all $`r n`$ experiments are shown in the table below.

```{r cache = TRUE}
DT::datatable(binom_outcomes %>% select(-i))
```

Now we can get a pretty good estimate of the distribution of $Y$. Recall, the distribution of a random variable is simply the probabilities of each possible outcome. The probability of a particular outcome, say $Y = 2$, is the long run proportion of experiments that result in that outcome. So, $P(Y = 2) = \frac{\text{# experiments with } Y = 2}{\text{# experiments}} = \frac{`r sum(binom_outcomes[["Y"]] == 2)`}{`r binom_n`} = `r round(sum(binom_outcomes[["Y"]] == 2)/binom_n, digits = 5)`$. If we do this for every possible value of $Y$, we get something that looks like the following:

```{r}
binom_outcomes %>% 
  janitor::tabyl(Y) %>% 
  rename(y = Y,
         `Estimated Probability` = percent,
         `# experiments with Y = y` = n) %>% 
  pander::pander()
```

We see that the most probable outcomes are around the middle (4,5,6) with proportions above 0.20. 

Another popular way of displaying this is using a histogram:

```{r}
binom_outcomes %>%  
  janitor::tabyl(Y) %>% 
  ggplot(aes(x = Y, y = n)) + 
    geom_bar(stat = 'identity', width = 1, col = 'black') +
    scale_x_continuous(breaks = c(1:10)) +
    theme_bw()
```

When viewing this, the probability of a given outcome can be interpreted as the area of the corresponding bar divided by the total area. 

As mentioned earlier, the distribution of a binomial random variable can also be calculated mathematically. We won't go into the details here, but take a look at the calculated probabilities below, and compare them to the estimates we got by flipping $`r n`$ coins $`r binom_n_print`$ times. 

```{r}
binom_outcomes %>% 
  janitor::tabyl(Y) %>% 
  mutate(Probability = dbinom(x = Y, size = 10, prob = 0.5)) %>% 
  rename(y = Y,
         `Estimated Probability` = percent,
         `# experiments with Y = y` = n) %>% 
  pander::pander()
```

### Normal Distribution {-}

The normal distribution is 

### t-distribution {-}

### Other Distribution

The four distributions above are the ones we'll consider, but there are many, many more out there. Here are a few examples.

#### Poisson Distribution {-}

The Poisson distribution is often used for counting things, such as the number of patients showing up in a clinic during a specified time period. It is a discrete distribution that only returns integer values. It depends on only one parameter which is often referred to as the rate parameter. It is displayed below with a few different values of the rate.

```{r}
tibble(lambda = c(1, 5, 10),
       n = list(c(0:20)),
       p = map2(n, lambda, function(x,y) dpois(x, y))) %>% 
  unnest() %>% 
  ggplot(aes(x = n, y = p, fill = as.character(lambda))) + 
    geom_histogram(stat = 'identity', position = "identity",
                   alpha = 0.75, width = 1, col = 'grey50') + 
    labs(y = 'Probabilities', fill = "Rate parameter") +
    theme_bw()
```

#### Exponential Distribution {-}

The exponential distribution is often used for wait times. It is a continuous distribution that depends on a single parameter, which is also called the rate parameter. 

```{r}
tibble(x = list(seq(0, 2, by = 0.05)),
       Rate = c(1,5,10),
       p = map2(x, Rate, function(x,y) dexp(x, y))) %>% 
  unnest() %>% 
  mutate(Rate = factor(Rate, levels = c(1, 5, 10))) %>% 
  ggplot(aes(x = x, y = p, fill = Rate)) + 
    geom_area(col = 'grey50', alpha = 0.75) + 
    facet_grid(~Rate) + 
    scale_y_continuous('', expand = expand_scale(mult = c(0,0), add = c(0, 2))) 
```

