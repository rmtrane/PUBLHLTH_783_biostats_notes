---
title: "Biostats Lecture 3: Introduction to Probability"
subtitle: "Public Health 783"
author: "Ralph Trane"
institute: "University of Wisconsin--Madison<br><br>"
date: "Fall 2019"
output:
  xaringan::moon_reader:
    self_contained: true
    css: [../css/uwmadison.css, default-fonts, ../css/extra-classes.css]
    lib_dir: libs
    nature:
      titleSlideClass: [center, top, .title-slide]
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ration: '16:9'
      navigation:
        scroll: false
---

```{r include = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, dpi=300)

options(DT.options = list(scrollX = TRUE))

library(tidyverse)
library(viridis)

## Set theme for plots (only works when you load ggplot2, which can be done using library(ggplot2) OR with library(tidyverse))
theme_set(theme_bw())

scale_color_continuous <- function(...) scale_color_viridis_c(...)
scale_fill_continuous <- function(...) scale_fill_viridis_c(...)

scale_color_discrete <- function(...) scale_color_viridis_d(...)
scale_fill_discrete <- function(...) scale_fill_viridis_d(...)

framingham <- read_csv("../../data/Framingham/framingham.csv") %>% 
  rename(gender = male) %>% 
  mutate(gender = if_else(gender == 1, 'male', 'female'))

```

# Learning Objectives

1.

---
layout: true

# Introduction to Probability

---
class: center

## Motivational Spiel

---

## Definitions

We talk about probabilities in regards to outcomes of an experiment. 

Two definitions. We will mainly be working with the second, but the first is included for completeness. 

1. If all outcomes are equally likely:
$$
  P(\text{event}) = \frac{\text{number of outcomes that result in event}}{\text{total number of possible outcomes}}
$$
2. In general: the long run proportion of times the event occurs if the experiment is repeated an *infinite number of times*


---

## Example: roll a die

Let $A = \{\text{roll is a 4}\}$, $B = \{\text{roll is a 1 or 5}\}$, and $C = \{\text{roll is even}\}$.

What is 

- $P(A)$, $P(B)$, and $P(C)$?

--

- $P(A \text{ OR } B)$, and $P(A \text{ OR } C)$? 

--

- $P(B \text{ and } C)$?

---
layout: true

# Introduction to Probability

## Example: Framingham Heart Study

---

What is the probability of developing Coronary Heart Disease over ten years?

--

You either develop the disease, or you do not, so.... $\frac{1}{2}$? 

--

Of course not! Why doesn't definition 1 work here?
--
 Outcomes not equally likely!
 
So instead, think about what would happen if we "repeat the experiment an infinite number of times"...

Before we can do that, specify what "the experiment" is.

--

Experiment = a randomly chosen individual develops CHD over a ten year period. 

---

Can't really do that... BUT we can pretend the FHS sample IS the population, and randomly choose individuals from this "population". 

```{r include = FALSE}
framingham <- read_csv("../../data/Framingham/framingham.csv") %>% 
  rename(gender = male) %>% 
  mutate(gender = if_else(gender == 1, 'male', 'female'))
```

```{r include = FALSE, eval = FALSE}
framingham_CHD_sample <- framingham %>% 
  sample_n(size = 10000, replace = TRUE)

write_rds(framingham_CHD_sample,
          path = 'framingham_CHD_sample.Rds')

is <- c(1:9, 
        seq(10, 90, by = 10),
        seq(100, 900, by = 100),
        seq(1000, 10000, by = 1000))

for(i in is){
  tmp <- framingham_CHD_sample %>% 
    filter(row_number() <= i) %>% 
    janitor::tabyl(TenYearCHD) %>% 
    mutate(TenYearCHD = as.character(TenYearCHD)) %>% 
    ggplot(aes(x = TenYearCHD, y = percent)) +
      geom_bar(data = data.frame(x = c('0','1'), y = c(0,0)), 
               stat = 'identity',
               aes(x = x, y = y),
               alpha = 0) +
      geom_bar(stat = 'identity') + 
      geom_text(aes(label = n, y = 0.07),
                fontface = 'bold', size = 8) + 
      scale_y_continuous(limits = c(0,1), breaks = seq(0, 1, by = 0.1)) +
      labs(x = 'TenYearCHD', y = 'proportion',
           title = paste0('Number of repetitions:\n', i)) + 
      theme(plot.title = element_text(size = 18, face = 'bold'))
  
  ggsave(tmp, filename = paste0('CHD_figures/', str_pad(i, width = 5, side = 'left', pad = '0'), '.jpg'),
         width = 7, height = 7)
}

system("ffmpeg -framerate 3 -pattern_type glob -i 'CHD_figures/*.jpg' -c:v libx264 CHD_prob_anim.mp4 -y")
```

<center>
  <video controls width="450" height="450">
    <source src="CHD_prob_anim.mp4" type="video/mp4">
  </video>
</center>


---

```{r}
if(!exists('framingham_CHD_sample'))
  framingham_CHD_sample <- read_rds('framingham_CHD_sample.Rds')
```


So from the above, we would estimate $P(\text{develops CHD over ten years}) = `r mean(framingham_CHD_sample[['TenYearCHD']])`$. 

In this case, we can actually get the exact probability (because we "know" the entire population): 

```{r}
framingham %>% 
  janitor::tabyl(TenYearCHD) %>% 
  janitor::adorn_totals() %>% 
  knitr::kable(format = 'html')
```

In general, we would estimate the probability in this way: the proportion of the sample with the attribute of interest. 

---
layout: false

Moral of the story: probabilities dictate the results of sampling (when done right).
--
 I.e. using probability theory, we can find out what to expect from sampling.

This allows us to judge if differences in samples are "as expected", or "out of the ordinary". 

---
layout: true

# Random Variables

---

## Why "Random Variables"?

We introduce *random variables* to

* formalize the notion of an experiment

* simplify notation 

* have a rigorous way of discussing probabilities

---

## What is a "Random Variable"?

A "random variable" is a variable tied to the outcome of an experiment. 

The value of it is unknown and uncertain before the experiment is conducted. 

Conducting the experiment results in a *realization* of the random variable. 

Examples: 

1. $X = \text{flip of a coin}$. Possible outcomes:
--
 heads and tails. 

--

2. $X = \text{sex of randomly chosen individual}$. Possible outcomes:
--
 male and female.

--

3. $X = \text{educational level of randomly chosen individual from the FHS}$. Possible outcomes:
--
 `r sort(unique(framingham$education), na.last = T)`.

--

4. $X = \text{height of randomly chosen 783 student}$. Possible outcomes:
--
 any number greater than $0$.

---

Talk about probabilities of different outcomes.


